{% if app.user and app.user.privateToken %}
    {% set rss_link = absolute_url(app.user.rssLink) %}
{% elseif not app.user %}
    {% set rss_link = url('csrdelft_forum_forum_rss') %}
{% else %}
    {% set rss_link = null %}
{% endif %}
<script type="text/javascript">
    const rssFeedButton = document.querySelectorAll('.rssFeedButton');
    const forumLinkButton = document.querySelectorAll('.forumLinkButton');

    // Linkjes worden uit de PHP gehaald
    const rssLink = '{{ rss_link }}';
    const forumLink = '{{ app.request.getUri() }}';

    // Event listener om RSS feed te delen
    rssFeedButton.forEach((item) => {
        item.addEventListener('click', async () => {
            try {
                if (rssLink === null) {
                    await location.assign('/profiel/{{ app.user.uid }}#tokenaanvragen');
                } else if ('share' in navigator) {
                    await navigator.share({
                        title: 'C.S.R. Delft Forum RSS feed',
                        url: rssLink
                    });
                } else if ('clipboard' in navigator) {
                    await navigator.clipboard.writeText(rssLink);
                    alert('RSS feed link is gekopieerd naar het clipboard'); // TODO: kan eleganter
                } else {
                    throw new Error('Kan niets met RSS feed');
                }
            } catch(err) {
                console.error(err.message);
            }
        });
    });

    // Event listener om forum feed te delen
    forumLinkButton.forEach((item) => {
        item.addEventListener('click', async () => {
            try {
                if ('share' in navigator) {
                    await navigator.share({
                        title: 'C.S.R. Delft Forum',
                        url: forumLink
                    });
                } else if ('clipboard' in navigator) {
                    await navigator.clipboard.writeText(forumLink);
                    alert('Forum link is gekopieerd naar het clipboard'); // TODO: kan eleganter
                } else {
                    throw new Error('Kan niets met forum link');
                }
                
            } catch(err) {
                console.error(err.message);
            }
        });
    });
</script>